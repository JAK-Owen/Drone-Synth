<!DOCTYPE html>
<html>

<head>
</head>
<script src='https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.6/Tone.js'></script>
<script src= 'https://cdn.jsdelivr.net/npm/nexusui@latest/dist/NexusUI.js'></script>
<link rel="stylesheet" href="styleSheet.css">


<body>
<div id='container'></div>

<div class= 'controls'>
<div class= 'wave-selector'>
  <input onclick='onWaveSelection(this.value)' type="radio" id="wave-type" name="wave" value="sine">
  <label for="sine">Sine</label>
  <br>
  <input onclick='onWaveSelection(this.value)' type="radio" id="wave-type" name="wave" value="triangle">
  <label for="triangle">Triangle</label>
  <br>
  <input onclick='onWaveSelection(this.value)' type="radio" id="wave-type" name="wave" value="square">
  <label for="square">Square</label>
  <br>
  <input onclick='onWaveSelection(this.value)' type="radio" id="wave-type" name="wave" value="sawtooth">
  <label for="sawtooth">Saw</label>
  <br>

</div>


<div id="gain">Volume<div>

<div id="LPFilter">LPF<div>

<div id="HPFilter">HPF<div>

<div id="ampEnv">Amp<div>

<div id="oscilloscope"><div>



</div>


<script>

 // Synth_________________________________________

 const volume = new Tone.Volume(-Infinity).toDestination();

 const LPfilter = new Tone.Filter(550, "lowpass").connect(volume);

 const HPfilter = new Tone.Filter(550, "highpass").connect(LPfilter);



const synth = new Tone.MonoSynth({
			"volume": -8,
			"oscillator": {
				"type": "sine"
			},
			"envelope": {
				"attack": 0.0,
				"decay": 1.0,
				"sustain": 1.0,
				"release": 1.0,
			},
			"filterEnvelope": {
				"attack": 0.0,
				"decay": 0.7,
				"sustain": 0.1,
				"release": 0.8,
				"baseFrequency": 300,
				"octaves": 4
			}});

    synth.connect(HPfilter);






// Keyboard____________________________________________

var notes = ['C','D','E','F','G','A','B'];
var html = "";

for (var octave = -2; octave < 0; octave++)
{
for (var i = 0; i < notes.length; i++) {
    var hasSharp = true;
    var note = notes[i];

    if (note == 'E' || note == 'B')
        hasSharp = false;
    html += `<div class='whitenote'onmousedown='noteDown(this, false)'
    data-note='${note + (octave+4)}'>`;

    if (hasSharp) {
    html += `<div class='blacknote'onmousedown='noteDown(this, true)'
    data-note='${note + '#' + (octave+4)}'></div>`;
    }
    html += '</div>';
}
}
document.getElementById('container').innerHTML = html;

function noteDown(elem, isSharp) {
  var note = elem.dataset.note;


  synth.triggerAttackRelease(note, "4n");

  event.stopPropagation()
}

// Controls___________________________________________


const gain = new Nexus.Dial("#gain",{

  'size': [75,75],
  'interaction': 'vertical',
  'mode': 'relative',
})
 gain.on('change',function(v) {
	volume.volume.rampTo(v,.1)
});
gain.min = -50;
gain.max = 0;
gain.value = -6;
gain.colorize("accent","white")
gain.colorize("fill","#333")
document.body.style.backgroundColor = "#000"




const LPFilter = new Nexus.Dial("#LPFilter",{

  'size': [75,75],
  'interaction': 'vertical',
  'mode': 'relative',
})
 LPFilter.on('change',function(v) {
	LPfilter.frequency.rampTo(v,.1)
});
LPFilter.min = 20;
LPFilter.max = 550;
LPFilter.value = 550;
LPFilter.colorize("accent","white")
LPFilter.colorize("fill","#333")
document.body.style.backgroundColor = "#000"


const HPFilter = new Nexus.Dial("#HPFilter",{

  'size': [75,75],
  'interaction': 'vertical',
  'mode': 'relative',
})
 HPFilter.on('change',function(v) {
	HPfilter.frequency.rampTo(v,.1)
});
HPFilter.min = 20;
HPFilter.max = 650;
HPFilter.value = 20;
HPFilter.colorize("accent","white")
HPFilter.colorize("fill","#333")
document.body.style.backgroundColor = "#000"



  function onWaveSelection(wave) {
   synth.oscillator.type = wave;
  }


  const ampEnv = new Nexus.Envelope('#ampEnv',{
   'size': [200, 100],
   'noNewPoints': false,
   'points': [
     {
       x: 0.1,
       y: 0.4
     },
     {
       x: 0.35,
       y: 0.6
     },
     {
       x: 0.65,
       y: 0.2
     },
     {
       x: 0.9,
       y: 0.4
     },
   ]
 })

 ampEnv.on('change',function(v) {
   console.log(v);
 })
 ampEnv.colorize("accent","white")
 ampEnv.colorize("fill","#333")
 document.body.style.backgroundColor = "#000"


  const oscilloscope = new Nexus.Oscilloscope('#oscilloscope',{
  'size': [150,100]
})
oscilloscope.colorize("accent","white")
oscilloscope.colorize("fill","#333")
document.body.style.backgroundColor = "#000"

oscilloscope.connect(volume)




</script>

</body>

</html>
